# SessionPool 운영 시나리오

---

## 1회성 초기 셋업

| 순서 | 작업 | 어디서 |
|------|------|--------|
| 1 | `clasp login` → `npm run deploy` | 터미널 |
| 2 | GAS 프로젝트에서 Calendar Advanced Service 활성화 | script.google.com → 서비스 추가 |
| 3 | Script Properties에 `RESEND_API_KEY` 설정 | GAS 프로젝트 설정 |
| 4 | 스프레드시트 열고 `initialSetup()` 실행 | Setup.gs |
| 5 | `CONFIG.ADMIN_EMAILS`에 관리자 이메일 등록 | Config.gs |
| 6 | `CONFIG.COHORTS`에 Meet 방 링크 등록 | Config.gs |
| 7 | SlothTime 사용 시: `TEMPLATE.DOC_ID`, `OUTPUT_FOLDER_ID`, `SHEET.ID` 설정 | Config.gs |

`initialSetup()` 실행 시 자동으로:
- "SessionPool" 마스터 시트 생성 (48개 시간 블록 헤더)
- 5분 간격 게이트 트리거, 자정/새벽 트리거 설치

---

## 매일 운영 흐름 (운영자)

**전날 저녁 또는 당일 새벽** — 2가지 작업:

### 작업 A: 내일 세션 시트 준비

1. 마스터 시트 → 관리자 메뉴 → **"📬 내일 시트 생성 + 발송"**
2. 확인 다이얼로그 → YES
3. 시스템이 자동으로:
   - 마스터 복제 → `[2026-02-07] SessionPool` 시트 생성
   - "Anyone with link can edit" 공유 설정
   - `activeSheetId` 업데이트 (트리거가 이 시트를 제어)
   - Resend API로 전체 사용자에게 링크 이메일 발송

### 작업 B: SlothTime 발송 (읽기/쓰기 세션 운영 시)

1. 관리자 메뉴 → **"📧 SlothTime 내일 발송"**
2. 확인 다이얼로그 → YES
3. 시스템이 자동으로:
   - 외부 시트에서 수신자 이메일 추출
   - Doc 템플릿 복사 + 편집 권한 부여
   - Calendar 이벤트 + Meet 링크 생성
   - HTML 이메일 개별 발송

**그 이후는 전부 자동.** 운영자가 할 일 없음.

---

## 자동 운영 (트리거)

| 시각 | 트리거 | 동작 |
|------|--------|------|
| **04:30** | `onDailyMorning()` | 사용자 라벨 새로고침, 드롭다운 갱신 |
| **매 정시/30분 (00~05분)** | `onGateOpen()` | 게이트 열림 → 사용자 세션 선택 가능 |
| **매 정시/30분 (05분~)** | `onGateClose()` | 게이트 닫힘 → 매칭 → Meet 방 배정 |
| **00:00** | `onDailyMidnight()` | 스트릭 체크 + 데이터 초기화 |

---

## 사용자 경험 (참여자 시점)

```
1. 이메일 수신 → 오늘의 시트 링크 클릭
2. 스프레드시트 열림 → 사이드바 "🚀 내 세션 열기" 클릭
3. 사이드바에서 확인:
   - 게이트 상태 (🟢 선택 가능 / 🔴 몰입 중)
   - 카운트다운 타이머
   - 내 인스타 핸들 + 🔥 스트릭
4. 게이트 열릴 때 → 세션 선택 (예: "몰입 @각자")
5. 5분 후 게이트 닫힘 → 자동 매칭
6. 내 셀에 Meet 링크 생성됨 → 클릭하여 입장
7. 파트너 1~2명과 30분 몰입 세션
```

**매칭 규칙:**
- 같은 세션 선택자끼리 2~3명 그룹
- 4명 → 2+2 (절대 3+1 안 함)
- 혼자 남으면 → Universal Pool (다른 세션 1인과 매칭 시도)
- 최종 1인 → Lobby 대기방

---

## 요약: 운영자의 하루

```
[전날 밤]
  1. 관리자 메뉴 → "📬 내일 시트 생성 + 발송"     ← 클릭 1번
  2. 관리자 메뉴 → "📧 SlothTime 내일 발송"        ← 클릭 1번 (선택)

[당일]
  아무것도 안 해도 됨. 트리거가 05:00~04:30 자동 운영.

[비정기]
  - 사용자 등록/삭제: 관리자 메뉴
  - 코호트 추가: 관리자 메뉴
  - 문제 발생 시: 강제 게이트 열기/닫기
```

운영자 일일 작업은 **클릭 1~2번**이 전부입니다.
